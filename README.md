# URL Shortener API (Flask)

RESTful API на Flask для создания коротких ссылок, перенаправления на исходный URL и просмотра статистики (клики и уникальные IP). Используется кэширование редиректов (Flask-Caching, TTL 1 час) и лимитирование (Flask-Limiter).

## Функциональность (по заданию)

### 1) Эндпоинты API
- `POST /shorten` — создание короткой ссылки.
  - Принимает: `url` и опционально `user_id`.
  - Возвращает: `short_code`.
- `GET /` — перенаправление на исходный URL.
  - Требует query-параметр `short` (код короткой ссылки).
  - Увеличивает счетчик кликов и регистрирует IP-адрес.
- `GET /stats/` — статистика по короткой ссылке.
  - Требует query-параметр `short`.
  - Возвращает количество кликов и список уникальных IP.

### 2) Кэширование (Flask-Caching)
- Редиректы кэшируются на 1 час (3600 секунд). 
- Если URL уже в кэше, исходный URL берётся из кэша без чтения таблицы ссылок из БД. 

### 3) Лимитирование (Flask-Limiter)
- Не более 10 созданий коротких ссылок на одного пользователя в сутки (`user_id`, иначе IP). 
- Не более 100 кликов по одной ссылке с одного IP-адреса в день. 

## Установка и запуск

### 1) Установка зависимостей
Из корня проекта:
python -m pip install -r requirements.txt
### 2) Запуск приложения
python app.py
По умолчанию сервер стартует на `http://127.0.0.1:5000`.

## Использование API (curl)

### Создать короткую ссылку
curl -X POST http://127.0.0.1:5000/shorten -H "Content-Type: application/json" -d "{"url":"https://example.com\",\"user_id\":\"u1\"}"

Пример ответа:
{"short_code":"AbCdEf12"}
### Перейти по короткой ссылке (редирект)
curl -i "http://127.0.0.1:5000/?short=AbCdEf12"


Ожидается ответ со статусом `302` и заголовком `Location: https://example.com` (редирект реализуется через `redirect()` Flask). 
### Получить статистику

curl "http://127.0.0.1:5000/stats/?short=QSL0tTog"


Пример ответа:
{
"short_code": "AbCdEf12",
"clicks": 3,
"unique_ips": ["127.0.0.1"]
}

## Тесты

Запуск unit-тестов из корня проекта:
python -m pytest -q

Запуск через `python -m pytest` часто надёжнее для импортов (корень проекта добавляется в `sys.path`).

## CI/CD (GitHub Actions)

Workflow запускается при каждом `push` в ветку `main` и выполняет:
- unit-тесты (`pytest`);
- проверку безопасности кода с помощью Bandit (используется `PyCQA/bandit-action`). 

Файл workflow: `.github/workflows/ci.yml`.

## Структура проекта

- `app.py` — Flask-приложение и роуты.
- `models.py` — работа с SQLite (ссылки/клики/статистика).
- `tests/test_api.py` — unit-тесты.
- `.github/workflows/ci.yml` — CI pipeline (pytest + bandit). 